# This is a basic workflow that is manually triggered
# This is a basic workflow that is manually triggered

name: Dynamic Secrets USER INPUT workflow

# Controls when the action will run. Workflow runs when manually triggered using the UI or API.
on:
  workflow_dispatch:
    # inputs:
    #   secrets_list:
    #     description: 'Comma-separated list of secrets to print'
    #     required: true
    #     default: 'AZURE_TOKEN,AZURE_SECRET_TOKEN'
    inputs:
      my_secrets:
        description: "list of secrets to fetch"
        required: true
   
jobs:
  ci:
    runs-on: ubuntu-latest

    steps:
      - name: Check
        uses: actions/checkout@v3

      # Install jq if not already installed
      - name: Install jq
        run: |
          if ! command -v jq &> /dev/null; then
            sudo apt-get update
            sudo apt-get install jq -y
          fi
      - name: Print GitHub Environment Variables
        run: |
          env  
          
       # View the secrets context
      - name: View secrets context
        run: echo "${{ toJson(secrets) }}"
        
      - name: Print Secrets
        env:
          SECRETS: '${{ toJson(secrets) }}'
          # INPUT_SECRETS_LIST: '${{ github.event.inputs.secrets_list }}'
         
      - run: |
          IFS=',' read -ra string_array <<< ${{ github.event.inputs.my_secrets }}

          for secret in "${string_array[@]}"; do
            value="$(jq -r --arg key "$secret" '.[$key]' <<< "$SECRETS" | sed 's|.|& |g')"
            echo "$secret: $value"
          done
          
        # run: |
        #   for secret in A B; do
        #     value="$(jq -r --arg key "$secret" '.[$key]' <<< "$SECRETS" | sed 's|.|& |g')"
        #     echo "$secret: $value"
        #   done
        # run: |
        #   IFS=',' read -ra SECRETS_ARRAY <<< "$INPUT_SECRETS_LIST"
        #   for secret in "${SECRETS_ARRAY[@]}"; do
        #     value="$(jq -r --arg key "$secret" '.[$key]' <<< "$SECRETS" | sed 's|.|& |g')"
        #     echo "$secret: $value"
        #   done
# name: Manual workflow

# # Controls when the action will run. Workflow runs when manually triggered using the UI
# # or API.
# on:
#   workflow_dispatch:
#     # Inputs the workflow accepts.
#     inputs:
#       name:
#         # Friendly description to be shown in the UI instead of 'name'
#         description: 'Person to greet'
#         # Default value if no value is explicitly provided
#         default: 'World'
#         # Input has to be provided for the workflow to run
#         required: true
#         # The data type of the input
#         type: string

# # A workflow run is made up of one or more jobs that can run sequentially or in parallel
# jobs:
#   # This workflow contains a single job called "greet"
#   greet:
#     # The type of runner that the job will run on
#     runs-on: ubuntu-latest

#     # Steps represent a sequence of tasks that will be executed as part of the job
#     steps:
#     # Runs a single command using the runners shell
#     - name: Send greeting
#       run: echo "Hello ${{ inputs.name }}"
